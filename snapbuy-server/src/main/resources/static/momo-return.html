<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>MoMo</title>
</head>

<body>

  <script>
    (function () {
      const urlParams = new URLSearchParams(window.location.search);
      const resultCode = urlParams.get('resultCode');
      const orderId = urlParams.get('orderId');
      const message = urlParams.get('message');

      console.log('ðŸŽ¯ MoMo Return - ResultCode:', resultCode, 'OrderId:', orderId);

      // XÃ¡c Ä‘á»‹nh backend URL (localhost hoáº·c production)
      const backendUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
        ? 'http://localhost:8080'
        : window.location.origin;

      // Gá»i API async (khÃ´ng Ä‘á»£i response)
      fetch(backendUrl + '/api/payments/momo/local-notify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          orderId: orderId,
          resultCode: parseInt(resultCode) || 0,
          transId: 'LOCAL-' + Date.now(),
          message: message || (resultCode === '0' ? 'Successful' : 'Failed')
        }),
        keepalive: true // Äáº£m báº£o request váº«n gá»­i khi tab Ä‘Ã³ng
      }).then(result => {
        console.log('âœ… Local callback triggered');
      }).catch(error => {
        console.error('âŒ Error calling local-notify:', error);
      });

      // ÄÃ“NG TAB NGAY Láº¬P Tá»¨C (khÃ´ng Ä‘á»£i API)
      window.close();

      // Thá»­ nhiá»u cÃ¡ch Ä‘Ã³ng tab
      setTimeout(() => {
        window.open('', '_self', '');
        window.close();
      }, 50);

      // Fallback cuá»‘i: Náº¿u váº«n khÃ´ng Ä‘Ã³ng Ä‘Æ°á»£c, hiá»ƒn thá»‹ message Ä‘Æ¡n giáº£n
      setTimeout(() => {
        document.body.innerHTML = '<div style="font-family:Arial;text-align:center;padding:50px">Vui lÃ²ng Ä‘Ã³ng tab nÃ y</div>';
      }, 300);
    })();
  </script>
</body>

</html>